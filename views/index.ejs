<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webchat da uou</title>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js'></script>
</head>
  
<body>
  <form>
    <label>Nome
      <input data-testid="nickname-box" id=inputName type='text'> 
    </label>
    <button type='button' data-testid="nickname-save" id='savename' >Salvar nome</button>
    <ul>
      <% if (getM) {
        getM.forEach((data) => {
      %>
          <li data-testid="message"><%= data %></li><%
        })
      }%>
    </ul>
    <input type='text' data-testid="message-box" id= 'text-input' placeholder="digite a msg">
    <button type='button' data-testid='send-button' id='send-btn'>Enviar</button>
  </form>
  <script>
    const socket= io();
    const textInput = document.getElementById('text-input');
    const sendBtn = document.getElementById('send-btn');
    const nickname = document.getElementById('inputName');
   
    let userId;

    socket.on('connected', (username, id) => {
      userId=id
      nickname=username
    })
    socket.on('message', (text) => {
      const list = document.getElementsByTagName('ul')[0];
      const line = document.createElement('li');
      line.setAttribute('data-testid', 'message');
      line.innerText = text;
      list.appendChild(line);
    })
    
    sendBtn.addEventListener('click',() =>{
      socket.emit('message', {
        nickname: nickname.value,
        chatMessage: textInput.value,
      });
      textInput.value = '';
      console.log(nickname.value)
    })
  </script>
</body>
</html>